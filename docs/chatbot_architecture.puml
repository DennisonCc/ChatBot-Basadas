@startuml
!theme plain
skinparam backgroundColor #0a0e1a
skinparam defaultFontColor #e2e8f0
skinparam defaultFontSize 11
skinparam shadowing false

skinparam package {
    BackgroundColor #1e293b
    BorderColor #6366f1
    BorderThickness 3
    FontSize 13
    FontStyle bold
    FontColor #a5b4fc
}

skinparam component {
    BackgroundColor #334155
    BorderColor #818cf8
    BorderThickness 2
    FontColor #e2e8f0
    RoundCorner 10
}

skinparam interface {
    BackgroundColor #064e3b
    BorderColor #34d399
    BorderThickness 2
    FontColor #d1fae5
}

skinparam database {
    BackgroundColor #581c87
    BorderColor #c084fc
    BorderThickness 2
    FontColor #e9d5ff
}

skinparam cloud {
    BackgroundColor #0c4a6e
    BorderColor #38bdf8
    BorderThickness 2
    FontColor #bae6fd
}

skinparam storage {
    BackgroundColor #92400e
    BorderColor #fb923c
    BorderThickness 2
    FontColor #fed7aa
}

skinparam note {
    BackgroundColor #1e3a8a
    BorderColor #60a5fa
    FontColor #dbeafe
}

skinparam arrow {
    Color #8b5cf6
    Thickness 2
}

title <size:16>Chatbot Architecture - Triple Memory System</size>

package "PRESENTATION LAYER" {
    component "Chatbot Widget" as Widget #4f46e5
}

package "APPLICATION LAYER" {
    component "API Routes" as Routes
    component "Chat Service" as ChatService
}

package "DOMAIN LAYER" {
    interface "IChatAgent" as IAgent
    interface "IBackendGateway" as IGateway
}

package "INFRASTRUCTURE LAYER" {
    
    package "Agent & Memory" {
        component "Pydantic Agent" as Agent
        component "Session History" as History
        component "Vector Store" as VectorStore
    }
    
    package "Data Persistence" {
        database "SQLite" as SQLite
        database "ChromaDB" as ChromaDB
    }
    
    package "External Access" {
        component "Flask Gateway" as Gateway
    }
}

package "EXTERNAL SERVICES" {
    cloud "Nvidia NIM\nLLM Service" as NvidiaLLM
    database "Flask API" as FlaskAPI
    storage "Knowledge Base\nMarkdown Files" as KB
}

Widget -down-> Routes : HTTP
Routes -down-> ChatService
ChatService -down-> IAgent : uses

Agent .up.|> IAgent : implements
Gateway .up.|> IGateway : implements

Agent -right-> History : 1. Session Memory
Agent -down-> VectorStore : 2. RAG Memory
Agent -down-> NvidiaLLM : Inference

History -down-> SQLite : stores
VectorStore -down-> ChromaDB : queries
VectorStore -right-> NvidiaLLM : Embeddings

Gateway -down-> FlaskAPI

note right of Agent
  <b>IMMEDIATE MEMORY</b>
  System Prompt
  Critical Rules
  Current Context
end note

note bottom of History
  <b>SHORT-TERM MEMORY</b>
  Last 10 messages
  Active conversation
  Thread context
end note

note bottom of VectorStore
  <b>LONG-TERM MEMORY (RAG)</b>
  Knowledge retrieval
  Semantic search
  Document chunks
end note

legend bottom left
  <b>MEMORY FLOW</b>
  1. Immediate - System instructions
  2. Session - Conversation history
  3. RAG - Knowledge base
endlegend

@enduml